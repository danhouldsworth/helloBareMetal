
#include <avr/io.h>
#include <avr/pgmspace.h>
#define _NOP() __asm__ __volatile__("nop");

const uint8_t bootOLED[] PROGMEM = {0xD5,0x80,0x8D,0x14,0x20,0x00,0x81,0xFF,0xAF};
const uint8_t buffer1[64 * 128 / 8] PROGMEM = {0,0,48,208,208,160,32,144,176,0,48,16,80,96,224,32,96,224,224,192,0,128,0,64,192,0,96,36,228,96,196,96,64,160,160,224,192,224,192,224,224,224,224,224,224,192,192,128,0,0,192,192,0,64,0,0,64,128,0,0,0,64,128,192,64,192,128,64,128,192,128,64,192,0,0,0,0,0,0,0,0,128,64,0,64,64,64,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,128,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,129,0,19,2,0,1,69,114,40,116,57,126,127,115,39,255,94,255,253,202,92,56,8,0,32,43,217,142,2,21,8,2,64,203,197,131,207,201,79,79,143,151,46,60,54,218,194,0,31,128,14,244,177,66,52,72,96,25,95,63,83,95,61,95,127,127,62,119,39,94,111,96,0,59,0,160,63,0,186,38,69,20,195,197,192,231,140,0,0,0,0,0,0,0,0,16,10,86,0,1,0,97,0,32,0,0,0,0,0,0,0,56,0,0,0,0,8,100,32,0,0,208,8,0,40,0,0,0,154,178,153,224,254,0,0,186,122,254,254,254,254,254,124,120,241,65,15,253,6,14,32,0,8,192,180,195,128,29,0,15,127,255,255,255,143,135,2,2,138,79,14,0,129,6,127,0,27,24,124,128,2,7,0,16,48,16,16,16,112,242,242,122,114,240,240,114,242,34,96,120,48,116,255,15,128,54,255,247,245,251,190,49,216,185,219,41,16,0,0,32,128,0,1,16,128,2,140,48,13,5,16,169,80,96,0,0,0,208,15,0,0,128,12,196,0,0,162,85,169,0,1,128,16,0,0,4,255,254,229,255,249,192,0,0,0,7,39,1,0,0,0,0,1,2,0,0,230,245,110,16,0,5,7,3,82,25,14,84,46,216,68,8,0,96,96,192,136,182,161,248,214,29,3,0,28,69,24,240,129,20,0,0,144,0,16,0,0,0,0,0,0,0,0,0,0,2,0,64,162,19,1,16,101,191,251,255,79,7,128,6,253,235,6,91,3,248,0,62,117,0,255,52,212,160,104,180,0,0,176,1,208,156,136,0,16,3,0,0,72,4,99,8,128,0,0,129,96,240,96,112,0,0,0,0,255,47,167,207,191,54,0,0,0,62,254,0,0,0,0,0,0,0,0,0,179,126,137,249,0,187,0,184,0,2,59,1,241,225,128,63,178,203,253,236,254,251,240,196,156,56,242,0,56,0,193,142,1,18,1,34,97,32,32,32,240,144,224,64,0,64,16,2,240,210,240,224,0,0,78,49,194,117,22,13,0,200,240,224,0,85,173,116,51,40,67,32,0,0,222,246,252,249,204,188,3,240,242,160,3,216,119,223,160,4,48,96,252,252,12,192,251,0,193,66,221,178,205,228,96,64,0,0,32,8,104,40,65,96,192,0,0,0,1,0,0,0,0,64,132,32,128,159,87,143,182,223,0,124,188,208,179,152,220,0,127,255,127,190,248,194,31,95,251,181,247,119,179,156,216,0,190,64,30,230,129,0,128,128,200,136,192,200,200,136,200,200,200,64,132,64,0,9,15,0,0,137,66,153,222,0,207,152,1,99,3,193,0,0,55,176,46,54,255,218,189,0,251,167,187,107,251,255,0,255,255,31,224,6,118,235,255,215,43,223,235,31,240,255,255,0,255,151,119,255,255,255,3,0,0,0,4,4,8,0,18,192,16,8,16,8,1,4,128,12,0,6,241,128,125,68,22,16,9,7,0,120,3,52,168,108,215,0,0,255,64,0,0,6,18,112,194,11,23,28,67,164,115,0,253,227,154,89,16,243,219,228,48,93,110,247,119,253,251,190,254,7,92,203,196,0,0,144,104,1,112,48,66,7,176,24,28,12,12,124,124,60,0,1,200,163,13,130,2,0,63,71,68,18,15,15,0,159,255,192,10,0,7,2,8,145,60,63,1,224,47,31,243,0,60,39,18,14,160,62,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,1,32,48,48,56,56,30,30,12,19,0,0,16,81,48,59,56,57,48,16,31,0,0,0,0,0,0,0,6,0,112,115,112,112,48,48,51,50,51,50,51,51,51,19,51,3,2,19,19,19,19,17,19,18,18,50,16,48,49,51,49,18,19,2,0,0,0,0,0,0,0,0,60,16,16,19,16,17,16,17,48,18,16,18,17,2,0,0,0,3,63,112,112,48,48,115,51,16,0,0,31,16,18,17,16,17,16,16,17,2,1,0,0};
const uint8_t buffer2[64 * 128 / 8] PROGMEM = {128,0,0,0,164,0,0,0,128,0,12,104,209,80,64,80,112,64,0,1,8,1,76,4,128,133,198,198,194,199,241,128,8,216,253,216,148,220,252,93,89,253,124,120,104,40,60,184,44,172,176,53,81,128,153,24,8,14,8,32,65,128,172,240,17,152,200,240,84,132,162,0,192,129,16,0,32,128,42,128,65,1,0,6,4,4,0,24,96,16,0,0,0,0,0,0,128,192,194,64,0,0,0,67,4,24,0,0,7,0,0,0,64,0,32,32,0,0,0,0,0,0,35,32,28,2,130,18,0,0,0,132,10,2,32,16,2,26,8,0,16,147,194,14,3,130,96,144,120,156,96,47,112,101,250,120,15,141,59,91,212,60,245,213,16,145,1,201,105,121,57,57,57,48,49,119,67,131,16,65,195,194,62,4,182,58,252,52,71,229,233,206,12,5,33,32,53,19,88,125,65,43,6,6,0,54,33,18,28,44,88,188,80,224,96,72,8,0,0,0,0,0,0,128,0,1,1,0,0,2,0,0,8,0,18,0,0,48,0,0,129,128,0,14,0,1,73,73,72,64,8,0,196,0,16,64,0,0,1,33,0,0,0,64,64,80,32,18,128,160,184,52,15,40,23,170,79,179,24,217,144,153,152,0,18,4,215,30,199,4,4,139,72,9,65,69,97,197,12,64,9,3,126,147,122,216,1,250,82,6,228,65,135,16,128,241,33,5,0,112,248,252,14,2,3,1,1,1,25,61,62,4,248,224,3,1,100,133,32,35,29,70,41,39,81,112,80,0,128,0,0,63,0,64,0,0,0,0,8,16,16,4,0,64,0,0,0,0,0,2,132,4,128,88,0,1,0,0,0,0,3,2,30,18,0,0,128,16,0,0,0,32,48,128,216,63,138,118,125,104,5,8,37,44,49,227,28,86,30,7,6,2,0,0,4,0,2,144,1,144,67,37,235,68,255,32,218,80,202,29,135,207,7,25,148,95,39,95,95,170,195,84,77,72,129,2,36,32,3,87,142,40,152,208,80,80,24,144,140,134,3,9,142,0,132,164,106,212,8,75,51,232,203,147,198,0,92,142,53,104,8,44,96,120,120,104,50,64,224,128,1,1,128,0,0,0,64,8,8,3,0,0,1,64,16,0,96,40,136,8,24,91,0,68,0,135,4,128,128,0,84,181,128,223,159,165,245,138,185,7,210,243,184,10,1,128,64,136,0,20,0,16,16,0,1,1,1,0,0,0,2,1,74,0,43,57,13,14,1,108,72,6,33,49,54,2,6,4,5,178,178,253,88,66,37,46,64,192,128,64,8,136,144,139,39,35,11,24,16,135,136,165,161,145,152,137,10,26,51,48,50,54,51,17,160,223,63,128,7,203,136,11,145,19,87,230,71,193,133,7,3,133,13,14,28,124,220,40,0,96,64,192,144,134,32,35,0,10,64,128,1,176,168,37,226,35,96,253,197,109,48,100,0,41,44,29,11,65,0,30,4,188,118,228,4,68,16,0,160,128,129,16,0,1,172,193,48,119,0,99,105,34,210,10,192,196,209,218,216,213,5,217,129,168,228,29,161,1,64,36,64,104,0,64,96,0,32,138,138,68,181,24,104,0,2,48,48,128,128,192,1,65,0,1,81,1,1,73,153,9,1,1,1,3,3,0,69,179,96,0,23,32,6,6,1,0,6,131,18,150,150,54,55,42,118,45,239,22,140,159,60,125,249,121,242,254,252,216,4,7,3,1,5,49,167,222,30,0,48,240,255,12,8,127,151,8,19,192,65,153,156,64,0,32,128,0,102,57,9,16,128,97,37,65,0,106,78,223,223,222,247,192,206,196,112,240,96,16,65,17,17,53,35,43,153,81,119,109,177,120,249,104,96,0,0,130,3,192,68,140,222,207,64,156,190,200,226,206,239,234,26,24,4,128,189,145,1,128,0,0,0,0,0,0,0,0,0,0,0,132,192,228,5,128,0,240,57,48,32,0,49,112,176,194,98,226,132,5,137,139,134,151,132,36,22,75,95,127,82,64,16,56,31,125,140,108,96,97,5,0,78,111,101,72,239,58,126,252,195,212,164,246,16,222,190,170,54,184,180,33,130,177,25,156,46,4,147,16,17,80,81,71,68,88,188,108,220,60,60,32,0,2,160,172,128,97,225,101,25,12,111,78,46,12,210,80,240,116,112,53,49,32,48,174,137,176,131,225,40,96,96,120,0,4,4,4,68,0,0,0,0,0,48,24,64,8,9,136,201,239,110,0,1,244,241,220,216,217,131,133,207,199,199,239,199,95,31,15,14,207,141,194,223,113};
const uint8_t buffer3[64 * 128 / 8] PROGMEM = {0,0,0,0,0,0,0,0,0,0,0,0,64,32,32,0,64,16,0,128,113,64,164,72,0,234,236,4,230,241,0,164,219,0,119,254,0,251,239,0,254,250,0,250,251,66,235,239,239,239,239,239,239,239,239,239,239,255,255,255,191,191,191,63,189,191,191,1,191,191,159,191,191,255,255,239,255,255,255,255,247,247,255,167,255,255,255,255,255,247,247,247,255,255,255,255,239,255,255,255,223,255,255,127,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,209,0,16,160,128,144,224,162,80,212,224,221,225,240,234,187,248,254,255,252,255,255,252,255,254,254,255,255,254,255,255,248,255,255,128,255,255,0,127,255,255,255,255,239,255,247,255,251,255,255,255,255,254,255,255,255,255,255,255,1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,254,127,254,254,254,254,126,190,191,95,223,63,103,239,71,135,1,63,0,17,94,253,255,239,127,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,4,64,92,120,124,127,123,92,255,126,253,255,127,127,254,127,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,127,255,255,239,127,127,251,125,127,0,127,127,127,63,47,7,7,7,7,7,7,7,39,7,7,87,71,67,67,71,71,7,7,23,7,15,7,7,15,7,7,7,7,15,7,7,15,71,23,15,131,219,153,1,208,8,94,14,78,222,88,144,78,254,223,115,224,223,59,118,246,255,255,255,243,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,221,253,253,253,253,253,185,253,253,253,253,253,253,253,189,253,157,93,125,125,253,253,125,125,253,253,253,253,253,253,253,189,127,59,62,191,95,63,31,63,131,3,57,109,64,6,189,168,125,250,194,0,134,0,0,2,34,3,3,4,6,5,36,32,4,0,36,12,60,0,0,4,33,36,8,12,12,4,0,0,0,0,0,72,1,71,78,191,25,98,127,248,192,86,14,97,127,254,235,95,177,252,181,233,203,127,255,255,255,255,249,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,247,255,255,255,255,255,255,255,255,255,255,127,255,255,127,254,255,255,253,253,255,253,253,253,254,255,255,255,255,255,255,255,255,249,254,191,255,248,249,240,226,208,0,143,175,183,103,126,2,255,252,227,49,1,224,0,71,0,0,0,10,18,0,0,3,1,54,51,55,57,8,42,0,0,0,16,84,49,145,19,177,185,64,32,0,196,48,7,95,65,223,4,63,255,30,228,231,254,0,139,48,17,103,77,30,59,127,255,255,127,247,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,31,255,255,128,255,255,224,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,255,247,255,255,254,191,255,15,254,254,252,251,255,255,240,208,240,228,240,224,244,244,224,228,226,224,224,224,240,244,241,240,244,244,244,240,240,224,128,224,240,224,162,241,241,241,176,181,173,191,144,138,57,32,233,239,0,47,239,239,252,239,251,128,170,178,111,235,255,255,239,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,192,255,255,142,255,191,15,175,175,139,175,235,224,235,235,255,239,239,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,0,250,251,249,251,251,251,243,251,251,235,255,255,222,254,254,190,190,254,254,126,254,254,254,254,254,254,254,255,254,254,254,255,255,31,255,255,255,255,255,255,255,255,255,255,255,255,253,253,251,253,246,244,233,123,15,145,159,191,253,245,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,63,255,255,255,255,255,255,255,255,250,234,170,170,174,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,255,255,255,255,255,196,253,253,125,253,253,253,253,253,255,255,255,255,255,255,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255};
const uint8_t buffer4[64 * 128 / 8] PROGMEM = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,184,56,24,88,24,16,16,80,65,0,1,65,0,195,195,143,30,31,27,63,58,243,255,223,191,255,254,255,255,127,255,191,127,235,126,124,23,31,29,15,7,1,5,14,1,11,18,7,2,2,0,132,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,64,0,12,48,8,0,0,0,0,0,192,0,0,0,0,0,128,128,128,196,192,0,0,16,24,0,0,2,51,135,6,0,32,0,67,70,247,127,255,255,95,86,1,4,2,129,128,100,0,0,64,96,96,0,0,0,0,0,0,0,1,64,1,3,9,4,7,31,156,160,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,4,0,0,128,32,56,252,244,247,29,253,249,238,230,252,223,125,189,223,255,219,254,252,189,188,156,44,8,64,29,21,0,0,160,1,62,101,109,104,0,0,0,0,0,30,75,128,224,192,248,224,240,236,236,72,232,200,200,192,200,0,128,224,160,112,244,60,236,192,136,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,12,132,78,231,255,125,255,255,255,255,255,255,255,255,254,253,243,127,126,107,48,4,0,4,0,0,0,0,0,194,233,8,16,152,32,0,0,0,0,0,0,1,105,214,143,255,255,255,255,255,255,254,255,253,255,251,49,159,139,179,6,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,9,233,35,35,229,119,95,255,119,15,151,207,195,1,73,17,113,40,240,0,0,0,0,0,0,0,0,40,190,189,253,255,25,62,16,0,0,0,0,0,0,0,8,195,7,3,55,47,255,255,127,255,127,188,191,207,245,160,53,1,0,0,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,128,0,242,230,208,242,3,33,252,226,131,7,2,3,2,129,1,0,2,0,22,5,58,74,192,92,252,126,236,248,248,242,113,160,192,64,64,0,64,0,0,0,0,0,0,0,0,0,0,8,145,195,137,174,15,20,11,35,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,128,65,13,79,255,244,240,193,15,7,59,96,32,0,1,7,6,60,62,52,120,124,120,248,248,248,248,240,224,246,240,240,240,224,248,248,96,120,120,16,56,0,0,0,0,0,148,156,223,243,248,254,239,25,45,6,128,192,4,32,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,24,0,0,1,23,17,20,64,0,128,128,16,0,32,0,192,128,128,128,0,16,1,1,3,7,3,3,5,1,99,0,0,3,0,0,0,0,0,0,0,8,0,64,192,72,127,63,31,7,192,64,224,16,29,7,3,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

void writeSPIstream(const uint8_t *ptr, uint16_t count){
    while(count--){
        SPDR = pgm_read_byte(ptr++);
        while(!(SPSR & (1<<SPIF)));
    }
}
void wait(){
    for(uint32_t delay = 0; delay < 500000; delay++) {_NOP();}
}
int main(void){
    PORTD = DDRD = (1 << DDD3) | (1 << DDD4);               // Reset / OLED DC
    PORTB = DDRB = (1 << DDB3) | (1 << DDB5) | (1 << DDB2); // MOSI SCK SS
    SPCR = (1 << SPE) | (1 << MSTR);
    SPSR = (1 << SPI2X);

    PORTD &= ~(1 << PORTD4); // OLED 'Commands'
    PORTB &= ~(1 << PORTB2);
    writeSPIstream(&bootOLED[0],9);
    PORTB |=  (1 << PORTB2);

    PORTD |=  (1 << PORTD4); // OLED 'Data'
    PORTB &= ~(1 << PORTB2);

    for(;;){
        writeSPIstream(&buffer1[0],1024); wait();
        writeSPIstream(&buffer2[0],1024); wait();
        writeSPIstream(&buffer3[0],1024); wait();
        writeSPIstream(&buffer4[0],1024); wait();
    }
}
