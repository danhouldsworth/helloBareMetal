#include <avr/io.h>
#include <avr/pgmspace.h>

#define WIDTH (128*4)
#define HEIGHT (64*1)

const uint8_t bootOLED[] PROGMEM = {0xD5,0x80,0x8D,0x14,0x20,0x00,0x81,0xFF,0xAF};
const uint8_t bigPhoto[ WIDTH * (HEIGHT / 8)] PROGMEM = {0,0,0,0,0,0,0,16,0,240,112,208,48,64,64,96,96,176,96,112,144,32,64,112,224,32,48,80,32,48,192,176,128,48,208,192,48,16,80,208,160,48,16,0,32,16,32,80,192,0,16,64,96,96,224,96,224,192,224,192,160,192,32,224,192,96,224,224,224,224,224,224,192,224,224,64,128,192,192,192,192,0,128,0,128,128,0,0,0,0,0,0,0,0,64,0,192,224,0,0,0,0,0,0,224,128,96,128,192,36,196,4,36,196,36,132,128,4,228,4,36,96,128,96,192,64,224,96,64,192,32,128,96,160,32,96,192,32,128,224,224,192,224,224,64,160,192,224,224,224,224,224,160,224,224,224,224,224,224,224,224,224,224,160,96,224,224,96,224,224,224,224,224,224,192,224,96,224,224,64,32,224,0,96,128,192,192,64,192,0,128,0,128,0,0,0,0,0,0,0,0,192,64,128,64,128,192,64,192,0,0,64,0,0,0,0,64,128,64,64,128,64,128,0,0,192,0,0,128,0,0,0,0,0,0,0,0,0,0,128,64,0,64,0,0,64,192,128,192,128,0,128,0,192,192,64,192,192,64,192,192,64,192,192,192,128,192,64,192,64,192,192,64,192,192,64,0,128,64,128,192,64,192,64,128,64,128,128,64,128,192,0,192,64,64,192,0,64,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,128,128,128,0,0,0,0,0,0,128,192,192,128,0,192,192,192,0,64,128,0,64,128,64,128,0,64,0,64,128,64,128,64,0,64,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,64,0,0,0,0,0,0,192,0,64,64,128,0,0,192,0,0,0,0,128,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,32,0,0,0,32,0,64,0,0,32,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,196,208,200,247,192,96,0,7,0,7,1,6,141,70,1,132,1,0,130,5,0,68,130,37,72,15,68,69,5,90,108,122,115,41,92,120,42,116,104,122,116,45,121,92,42,117,124,126,93,61,61,95,123,61,125,123,119,111,127,87,127,111,127,255,255,255,255,190,30,175,247,255,251,123,95,223,255,115,247,202,74,181,246,68,156,158,14,44,28,140,164,0,56,32,0,0,0,0,1,33,2,1,22,59,21,26,45,22,73,166,194,12,130,4,5,130,5,2,131,21,144,199,240,8,13,0,0,1,195,197,194,66,65,67,197,199,196,197,199,195,197,195,196,199,195,197,195,205,207,203,77,75,79,71,75,79,195,207,79,71,223,79,78,207,143,158,143,151,159,14,30,62,39,15,99,122,52,120,220,54,11,49,61,238,249,233,240,240,203,159,220,0,0,0,0,3,63,80,15,132,1,3,4,10,22,8,58,84,171,154,64,160,208,72,56,215,250,169,222,40,116,104,0,72,36,64,104,34,88,40,119,27,8,3,104,119,31,104,91,127,119,125,125,87,112,116,103,103,94,125,126,114,125,126,127,95,123,125,127,127,125,127,127,127,123,127,127,127,124,127,127,117,103,102,71,119,101,93,63,70,87,101,71,33,79,81,0,64,96,112,32,96,16,0,0,10,2,0,0,0,128,188,129,0,208,224,248,126,63,7,1,0,128,192,112,56,186,189,137,106,23,9,18,17,1,200,98,64,198,208,4,193,192,12,193,192,141,194,196,129,192,195,168,230,193,128,197,193,12,48,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,0,0,0,0,0,0,0,0,0,0,30,64,152,4,96,16,2,104,16,32,0,22,160,10,38,64,1,0,64,1,0,64,129,32,3,176,32,67,144,96,0,32,96,16,128,48,64,136,16,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,196,60,24,4,2,1,0,0,0,0,0,0,0,0,0,0,0,0,16,0,4,16,40,84,239,97,214,0,192,86,160,0,144,160,0,0,32,64,32,192,64,224,0,32,0,64,8,0,0,0,0,32,4,104,0,0,0,0,0,0,0,0,0,0,0,0,28,147,213,199,153,191,178,152,254,96,208,136,178,242,236,240,240,250,240,252,186,240,233,0,0,0,0,0,16,254,122,248,254,248,120,254,250,250,248,254,254,254,254,254,254,254,254,254,254,254,254,254,254,126,254,188,254,252,252,252,252,252,252,248,120,120,120,241,241,241,227,227,129,5,7,7,31,31,107,47,247,71,232,134,60,243,135,70,14,249,103,9,13,60,248,128,0,0,0,8,24,52,40,72,192,160,192,192,176,193,229,2,213,2,125,69,194,221,32,30,5,2,1,0,0,0,0,2,127,127,127,126,255,255,255,255,255,255,127,255,255,255,255,255,255,191,143,143,143,135,135,143,135,134,130,6,130,130,130,6,130,130,134,6,138,15,7,95,63,31,63,30,14,128,0,0,128,0,27,16,144,72,99,166,0,15,142,255,15,15,31,0,0,0,0,1,121,144,12,28,9,28,20,44,86,0,244,16,248,80,161,83,0,22,30,2,15,6,31,0,0,0,0,0,60,240,252,112,112,48,120,80,16,16,16,16,16,16,16,16,16,48,48,48,96,98,32,112,114,242,114,114,242,250,250,242,114,250,114,242,112,112,240,242,112,112,112,240,242,114,114,242,114,242,242,114,114,114,242,114,50,96,32,106,96,96,96,112,48,56,112,48,48,48,48,112,242,248,252,254,255,124,126,31,15,3,1,128,192,240,252,246,191,159,175,155,247,111,249,251,247,210,123,245,208,121,237,225,122,249,241,251,183,119,255,250,121,123,121,60,154,57,121,41,184,251,105,243,219,79,14,10,0,112,160,48,0,0,0,0,0,0,0,0,0,0,0,128,32,248,31,128,248,255,62,0,0,0,0,0,25,0,0,0,82,128,0,1,0,2,128,0,1,4,2,73,166,18,72,34,24,13,2,24,12,194,66,0,0,0,8,4,16,32,116,216,49,20,170,80,144,174,80,40,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,160,208,240,56,30,14,3,1,0,0,0,0,0,0,0,0,0,128,96,0,12,0,131,0,132,100,0,192,32,16,0,0,0,0,0,1,128,32,208,186,227,49,162,64,137,194,5,162,18,5,10,2,0,0,0,0,192,32,224,0,108,1,0,0,0,0,0,0,0,0,0,0,0,6,191,191,63,159,127,255,92,253,179,247,255,231,239,207,247,255,251,255,243,255,255,255,253,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,1,47,255,215,207,7,1,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,4,0,0,0,0,0,1,10,95,242,173,185,154,243,231,26,153,46,240,128,17,16,0,0,0,0,0,12,63,17,15,3,13,11,133,3,5,11,17,157,58,0,123,36,78,83,44,144,91,12,38,84,234,166,88,162,144,42,38,64,32,16,208,36,56,64,80,136,176,40,0,0,16,0,0,0,0,32,20,56,96,80,96,196,32,96,224,128,8,168,200,0,216,206,248,228,68,253,146,248,207,241,108,208,254,254,80,167,99,93,28,66,64,3,1,16,0,0,0,0,0,0,28,4,32,133,52,187,169,80,128,100,32,208,112,128,15,2,13,10,8,44,18,12,16,13,0,0,8,80,0,57,64,128,16,0,0,0,128,0,0,0,64,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,2,0,0,2,32,16,130,0,16,0,80,18,3,3,1,0,128,192,32,152,76,2,71,103,155,194,60,159,106,247,207,123,247,237,63,247,255,27,207,79,27,26,7,7,130,129,192,0,0,2,6,13,31,62,249,221,119,248,91,179,199,23,27,7,19,255,174,122,252,129,16,7,58,124,76,240,96,192,0,0,6,12,62,127,255,248,96,55,63,1,0,0,0,0,184,50,48,216,120,23,72,176,214,104,58,195,56,210,64,208,72,248,116,200,156,44,14,6,128,1,0,0,0,0,128,176,232,224,0,0,1,2,2,0,228,218,36,104,152,0,26,16,8,152,16,128,128,0,0,0,16,24,13,6,3,1,0,0,0,0,0,0,0,128,0,0,16,200,4,10,7,4,8,16,2,40,128,208,0,0,0,0,0,192,224,192,0,0,0,0,0,97,243,65,129,136,72,129,228,192,176,96,64,241,0,8,120,4,201,10,96,81,1,132,28,0,0,0,0,0,0,0,0,0,0,0,0,0,43,62,127,126,27,127,79,43,243,167,71,167,47,15,143,207,155,255,127,191,230,31,63,4,0,0,0,0,0,0,0,0,0,0,0,0,0,20,30,127,255,255,255,30,246,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,240,211,161,253,243,118,254,104,125,244,237,99,28,253,232,192,128,0,0,0,2,57,35,78,129,2,38,45,72,156,160,64,206,131,88,60,96,80,193,201,6,51,10,3,0,1,1,240,240,241,241,242,224,225,225,192,198,134,136,29,18,63,47,112,120,112,155,206,150,223,224,146,89,111,183,192,229,248,239,255,249,249,254,237,255,255,251,249,241,240,240,225,160,160,196,200,140,156,28,24,56,48,116,112,120,246,254,0,0,0,0,0,0,112,56,0,255,1,2,192,0,134,193,2,2,4,194,15,24,19,228,192,0,56,2,247,40,2,0,2,1,0,114,33,32,0,97,0,33,96,96,32,32,32,32,96,48,32,160,224,240,240,176,224,208,240,224,208,208,240,192,192,192,192,0,0,66,80,0,192,193,64,0,80,3,32,0,16,144,2,16,16,82,240,224,240,208,240,208,240,208,208,242,240,240,224,32,32,1,2,0,0,0,0,128,64,16,206,67,81,132,113,28,78,52,30,241,244,138,117,55,10,21,15,19,133,234,35,13,2,1,1,128,0,208,232,204,255,255,241,224,224,224,224,248,224,128,0,0,1,24,21,84,71,3,137,47,18,40,92,112,120,229,117,130,130,5,56,112,209,170,65,64,64,128,96,64,64,1,0,0,0,0,0,0,0,222,223,246,127,234,242,225,228,232,248,244,234,254,252,251,247,118,231,221,255,103,222,254,187,255,11,1,0,0,224,240,251,240,241,236,217,252,208,96,0,0,0,3,22,36,248,248,247,255,252,231,223,243,223,222,244,252,240,224,192,192,130,128,128,192,160,112,88,28,208,120,242,251,252,244,249,124,252,253,248,114,28,11,1,0,128,224,248,248,246,119,185,127,0,0,0,0,0,239,110,229,205,210,245,226,245,139,226,253,170,186,233,242,227,253,254,210,245,182,226,255,250,0,0,0,0,64,0,0,0,0,0,0,0,0,208,19,0,32,8,72,134,8,1,2,72,32,152,9,4,80,3,140,1,243,182,64,46,192,0,0,128,128,0,64,128,0,0,0,0,0,0,0,0,8,15,15,7,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,192,200,192,64,192,0,128,2,32,32,128,192,128,0,152,226,127,149,119,111,79,127,159,159,27,41,250,220,245,133,233,123,223,223,79,0,0,0,0,172,125,124,254,255,180,220,188,252,216,240,167,217,160,243,118,38,52,58,57,8,222,204,0,0,0,0,31,255,63,127,63,255,255,255,127,127,247,127,127,63,222,62,28,188,184,120,113,97,226,199,133,15,31,31,63,63,93,219,175,117,219,251,95,191,245,255,251,183,247,187,91,51,247,118,199,223,67,167,36,78,156,52,40,16,216,8,8,0,0,0,0,0,188,44,240,240,0,111,15,68,207,27,48,57,208,102,0,3,128,193,242,52,8,64,71,139,64,128,0,0,128,0,76,8,200,72,72,72,192,136,192,200,72,196,200,72,200,192,200,200,204,200,200,200,136,9,200,136,200,200,136,200,200,200,200,64,72,200,72,76,0,72,136,196,128,0,64,128,64,64,0,0,0,9,9,1,9,1,9,13,15,15,7,1,0,0,0,192,0,0,8,230,195,120,231,13,82,15,57,112,136,16,2,104,34,220,161,14,8,2,4,70,155,196,3,129,24,200,192,0,0,1,2,128,195,99,35,131,131,3,195,1,193,225,1,225,64,0,64,0,0,24,121,44,83,55,40,6,204,180,156,104,38,86,81,59,62,52,251,223,127,254,90,254,255,203,233,29,217,188,0,0,0,0,0,255,251,191,255,223,143,231,71,63,63,171,239,91,251,74,47,63,223,243,231,28,29,236,39,1,0,0,0,192,255,255,255,255,255,255,95,95,143,127,255,60,112,192,0,0,4,15,15,95,115,238,93,63,187,235,127,255,239,119,127,191,221,135,234,237,125,122,63,151,159,143,233,250,235,247,239,127,63,6,0,128,224,240,248,255,255,255,255,254,255,127,254,124,0,0,0,0,52,255,255,231,199,191,95,255,255,95,206,255,255,255,159,127,255,127,255,191,253,255,207,223,195,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,4,12,1,16,64,6,59,5,4,0,0,0,0,0,19,13,2,16,12,0,50,64,32,0,80,8,12,49,8,4,0,0,33,80,0,20,0,128,1,196,32,1,112,16,192,4,0,0,0,8,14,128,4,136,128,48,0,136,48,16,3,24,40,0,81,232,130,129,64,129,135,10,112,61,70,75,5,64,4,34,58,60,4,27,0,20,25,3,13,1,3,195,7,7,0,0,0,0,128,28,116,124,37,226,3,145,138,59,37,114,234,1,128,137,49,94,204,114,176,167,71,139,2,0,0,0,0,40,0,0,255,255,255,255,255,255,14,136,134,0,0,0,0,0,0,0,0,2,1,0,3,11,2,22,20,12,24,144,96,225,225,194,131,7,11,15,7,7,35,7,23,44,30,56,15,163,103,203,163,193,104,243,79,6,51,67,0,0,0,0,0,156,255,68,160,32,35,131,128,158,132,127,95,180,250,89,241,227,16,128,192,192,224,115,207,181,202,247,117,201,224,236,153,29,8,97,113,62,223,57,166,253,255,190,255,15,175,245,251,235,255,119,191,255,255,253,215,239,255,251,255,221,159,254,255,187,254,215,197,205,107,3,233,32,92,222,129,116,194,8,2,25,204,130,0,32,16,4,2,1,0,0,192,64,128,0,19,208,162,76,8,160,1,6,143,201,98,128,128,8,48,92,204,0,132,11,47,3,13,2,0,1,96,120,24,8,8,24,8,24,24,28,12,12,44,12,44,12,12,28,60,125,124,124,124,252,124,252,252,60,60,28,44,8,0,0,0,0,1,1,0,16,68,203,79,192,161,43,88,60,5,27,54,71,3,7,7,1,10,91,254,0,0,0,0,0,189,1,46,28,97,19,56,66,96,135,43,126,6,16,1,192,15,129,249,3,12,3,0,0,0,0,0,63,207,95,127,255,255,255,255,240,244,160,1,1,8,1,2,16,192,0,0,0,7,14,10,1,2,162,159,0,8,0,192,35,215,46,30,140,60,28,7,5,31,47,14,7,1,1,0,0,128,240,254,31,47,127,127,55,31,159,255,207,227,240,191,2,0,0,0,0,156,28,0,45,120,7,197,5,22,51,15,223,3,207,199,88,56,193,203,3,92,42,232,189,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,1,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,1,0,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,16,16,16,17,48,48,49,48,48,56,56,56,56,56,56,56,56,56,60,62,30,28,28,28,30,30,30,28,12,12,28,14,6,6,2,3,0,16,0,16,16,0,17,50,16,49,18,16,16,50,57,48,48,48,57,57,59,50,57,123,58,56,57,122,58,56,120,56,112,48,48,48,48,80,31,31,31,63,31,7,2,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,15,6,12,8,8,16,16,48,48,240,112,112,113,114,112,113,113,112,113,112,112,112,48,48,48,112,48,48,112,48,49,48,49,18,49,51,50,48,49,50,16,51,50,49,51,17,51,50,49,51,50,49,51,48,51,51,51,51,48,51,35,49,50,51,50,3,19,2,3,3,3,17,3,2,19,19,19,19,19,19,19,19,18,19,19,19,19,19,19,19,19,18,17,19,18,19,19,19,18,49,17,18,19,17,18,51,49,18,18,51,17,48,16,48,16,16,50,48,50,50,49,18,19,48,51,17,51,50,49,19,18,49,17,18,49,51,50,17,18,16,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,23,30,56,16,16,16,16,16,16,16,16,16,16,16,21,19,19,17,16,48,16,17,48,16,16,17,18,18,17,19,48,51,16,48,48,48,48,18,18,16,16,16,16,16,19,16,19,17,18,16,17,18,1,1,2,1,2,1,0,0,0,0,0,0,0,0,0,3,2,1,7,15,63,63,63,49,52,120,112,114,112,112,116,112,48,112,48,48,114,48,114,50,112,51,51,114,115,112,51,48,49,18,0,2,1,1,0,0,0,0,0,0,4,31,31,16,16,16,16,16,16,17,16,16,16,16,18,16,16,16,16,16,16,17,19,16,17,16,18,18,16,17,16,16,18,16,18,2,1,1,2,0,1,1,0,0,0,0,0,0,0,0,0,0};

void writeSPIstream(const uint8_t *ptr, uint16_t count){
    while(count--){
        SPDR = pgm_read_byte(ptr++);
        while(!(SPSR & (1<<SPIF)));
    }
}

int main(void){
    PORTD = DDRD = (1 << DDD3) | (1 << DDD4);               // Reset / OLED DC
    PORTB = DDRB = (1 << DDB3) | (1 << DDB5) | (1 << DDB2); // MOSI SCK SS
    SPCR = (1 << SPE) | (1 << MSTR);
    SPSR = (1 << SPI2X);

    PORTD &= ~(1 << PORTD4); // OLED 'Commands'
    PORTB &= ~(1 << PORTB2);
    writeSPIstream(&bootOLED[0],9);
    PORTB |=  (1 << PORTB2);

    PORTD |=  (1 << PORTD4); // OLED 'Data'
    PORTB &= ~(1 << PORTB2);

    for(;;){
        for (uint16_t x = 0; x < WIDTH - 128; x++)
            for (uint8_t col = 0; col < 8; col++)
                    writeSPIstream(&bigPhoto[x+col*WIDTH], 128);
        for (uint16_t x = WIDTH - 128; x > 0; x--)
            for (uint8_t col = 0; col < 8; col++)
                    writeSPIstream(&bigPhoto[x+col*WIDTH], 128);
    }
}
